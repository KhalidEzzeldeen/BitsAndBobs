function [TotT,TotxSol] = myfun(Values,x0,Tfin,N,Const)

% x = fmincon(@myfun,x0,A,b,Aeq,beq,options)
% A = [1,0,0,0,0,0;     b = [1;     And '-' constraints as well.
%      0,0,1,0,0,0;          1;
%      0,0,0,0,1,0]          1];
% options=optimset('MaxFunEvals', 5000, 'TolFun',1e-8, 'TolX', 1e-8, 'MaxIter', 5000);

beta = Const(1);
rho = Const(2);
TotxSol = [];
TotT = [];
xStart = x0;
J = 0;
for Section = 1:N
    u = Values(2*Section-1:2*Section);
    [T,xSol] = ode45(@(t1,x1)DiffEqIn(t1,x1,u,beta),[0,Tfin/N],xStart);
%     J = J + (10*u(1)^2 + 4*u(2)^2)*(Tfin/N);
    xStart = xSol(end,:);
    TotT = [TotT; T];
    TotxSol = [TotxSol;xSol];
    
end
% J = J + rho((xSol(end,1)-4)^2 + (xSol(end,2)-4)^2);

%Make plot for Controls
color = {'-b+','-ro','--b*','--rx',':bd',':rs','-.bv','-.r^'};
tint = linspace(Start,Stop);

figure;
title({'\fontsize{16}  Optimal Controsl for ';...
        ['beta = ' num2str(beta) ', N = ' num2str(N) ', Rho = ' num2str(rho)]});
xlabel('\fontsize{13} Time Units');
ylabel('\fontsize{13} u / Theta');
hold on
for S = 1:N
    tint = (S-1)*(T/N):res:S*(
    plot(tint,U,color{4},...
         tint,X,color{5},...
         
end
legend('\fontsize{13} u',...
       '\fontsize{13} Theta',...
       'Location','Best');
hold off


function dxdy = DiffEqIn(~,x,u,beta)
%[T,Y] = solver(odefun,tspan,y0,options)
%u = [u, theta];
q = (beta / ((x(2)^2 + (x(1)-3)^2)^(3/2))).*[3-x(1);x(2)];
dxdy = [x(3);...
        x(4);...
        u(1)*cos(u(2)) + q(1);...
        u(1)*cos(u(2)) + q(2)];   